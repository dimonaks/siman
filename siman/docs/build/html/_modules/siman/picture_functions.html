
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>siman.picture_functions &#8212; Siman 0.9.5 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Siman 0.9.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for siman.picture_functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*- </span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">absolute_import</span> 
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>


<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">spline</span> 
<span class="c1"># print (scipy.__version__)</span>
<span class="c1"># print (dir(interpolate))</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span>  <span class="n">CubicSpline</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scipy.interpolate.CubicSpline is not avail&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">adjustText</span> <span class="k">import</span> <span class="n">adjust_text</span>
    <span class="n">adjustText_installed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">adjustText_installed</span> <span class="o">=</span> <span class="kc">False</span>



<span class="kn">from</span> <span class="nn">siman</span> <span class="k">import</span> <span class="n">header</span>
<span class="kn">from</span> <span class="nn">siman.header</span> <span class="k">import</span> <span class="n">calc</span><span class="p">,</span> <span class="n">print_and_log</span><span class="p">,</span> <span class="n">printlog</span>
<span class="kn">from</span> <span class="nn">siman.inout</span> <span class="k">import</span> <span class="n">write_xyz</span>
<span class="kn">from</span> <span class="nn">siman.small_functions</span> <span class="k">import</span> <span class="n">makedir</span>
<span class="kn">from</span> <span class="nn">siman.geo</span> <span class="k">import</span> <span class="n">replic</span>

<span class="kn">from</span> <span class="nn">siman.chg.chg_func</span> <span class="k">import</span> <span class="n">chg_at_point</span><span class="p">,</span> <span class="n">cal_chg_diff</span>
<span class="c1"># from dos.functions import plot_dos</span>
<span class="c1"># from ase.utils.eos import EquationOfState</span>

<div class="viewcode-block" id="plot_mep"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.plot_mep">[docs]</a><span class="k">def</span> <span class="nf">plot_mep</span><span class="p">(</span><span class="n">atom_pos</span><span class="p">,</span> <span class="n">mep_energies</span><span class="p">,</span> <span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fitplot_args</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">style_dic</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used for NEB method</span>
<span class="sd">    atom_pos (list) - xcart positions of diffusing atom along the path,</span>
<span class="sd">    mep_energies (list) - full energies of the system corresponding to atom_pos</span>

<span class="sd">    image_name - deprecated, use filename</span>
<span class="sd">    style_dic - dictionary with styles</span>
<span class="sd">        &#39;p&#39; - style of points</span>
<span class="sd">        &#39;l&#39; - style of labels</span>
<span class="sd">        &#39;label&#39; - label of points</span>

<span class="sd">    plot - if plot or not</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="kn">from</span> <span class="nn">analysis</span> <span class="k">import</span> <span class="n">determine_barrier</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">image_name</span>

    <span class="c1">#Create</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">style_dic</span><span class="p">:</span>
        <span class="n">style_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fitplot_args</span><span class="p">:</span>
        <span class="n">fitplot_args</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># print</span>

    <span class="n">atom_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">atom_pos</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">atom_pos</span><span class="o">.</span><span class="n">T</span> <span class="c1">#</span>
    <span class="n">tck</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splprep</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#now we get all the knots and info about the interpolated spline</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">500</span><span class="p">),</span> <span class="n">tck</span><span class="p">)</span> <span class="c1">#increase the resolution by increasing the spacing, 500 in this example</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


    <span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">path_length</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">mep_pos</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">*</span><span class="n">path_length</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">u</span><span class="p">])</span>


    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#plot the path in 3d</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;originalpoints&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;Dodgerblue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>





    <span class="c1"># if &#39;_mep&#39; not in calc:</span>
    <span class="n">calc</span><span class="p">[</span><span class="s1">&#39;_mep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_pos</span><span class="p">,</span> <span class="n">mep_energies</span><span class="p">]</span> <span class="c1"># just save in temp list to use the results in neb_wrapper</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;plot_mep_invert&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">header</span><span class="o">.</span><span class="n">plot_mep_invert</span><span class="p">:</span> <span class="c1"># for vacancy</span>
        <span class="n">mep_energies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">mep_energies</span><span class="p">)</span> <span class="p">)</span>

    <span class="n">mine</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mep_energies</span><span class="p">)</span>
    <span class="n">eners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mep_energies</span><span class="p">)</span><span class="o">-</span><span class="n">mine</span>

    
    
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path_length</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># ynew = spline(mep_pos, eners, xnew )</span>
    <span class="c1"># spl = CubicSpline(mep_pos, eners, bc_type = &#39;natural&#39; ) # second-derivative zero</span>
    <span class="c1"># spl = CubicSpline(mep_pos, eners,) #</span>
    <span class="c1"># spl = CubicSpline(mep_pos, eners, bc_type = &#39;periodic&#39;) </span>
    <span class="c1"># spl = CubicSpline(mep_pos, eners, bc_type = &#39;clamped&#39; ) #first derivative zero</span>



    <span class="n">spl</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">mep_pos</span><span class="p">,</span> <span class="n">eners</span><span class="p">)</span>


    <span class="n">ynew</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

    <span class="n">diff_barrier</span> <span class="o">=</span> <span class="n">determine_barrier</span><span class="p">(</span><span class="n">mep_pos</span><span class="p">,</span> <span class="n">eners</span><span class="p">)</span>


    <span class="n">print_and_log</span><span class="p">(</span><span class="s1">&#39;plot_mep(): Diffusion barrier =&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">diff_barrier</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="s1">&#39; eV&#39;</span><span class="p">,</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="c1"># sys.exit()</span>
    <span class="c1"># print()</span>

    <span class="k">if</span> <span class="s1">&#39;fig_format&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitplot_args</span><span class="p">:</span>
        <span class="n">fitplot_args</span><span class="p">[</span><span class="s1">&#39;fig_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;eps&#39;</span>

    <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitplot_args</span><span class="p">:</span>
        <span class="n">fitplot_args</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="kc">None</span>  <span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitplot_args</span><span class="p">:</span>
        <span class="n">fitplot_args</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Reaction coordinate ($\AA$)&#39;</span>


    <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fitplot_args</span><span class="p">:</span>
        <span class="n">fitplot_args</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Energy (eV)&#39;</span>

    <span class="n">path2saved</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="c1"># print(image_name)</span>
        <span class="n">path2saved</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">orig</span> <span class="o">=</span> <span class="p">(</span><span class="n">mep_pos</span><span class="p">,</span> <span class="n">eners</span><span class="p">,</span> <span class="n">style_dic</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">],</span> <span class="n">style_dic</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]),</span> 
            <span class="n">spline</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">style_dic</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">),</span> 
        <span class="n">image_name</span> <span class="o">=</span>  <span class="n">image_name</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="n">show</span><span class="p">,</span> 
        <span class="o">**</span><span class="n">fitplot_args</span><span class="p">)</span>

        <span class="c1"># print(image_name, filename)</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;DFT points:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mep_pos</span><span class="p">,</span> <span class="n">eners</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10.5f}</span><span class="s1">, </span><span class="si">{:10.5f}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Spline:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10.5f}</span><span class="s1">, </span><span class="si">{:10.5f}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>





    <span class="k">return</span> <span class="n">path2saved</span><span class="p">,</span> <span class="n">diff_barrier</span></div>


<div class="viewcode-block" id="process_fig_filename"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.process_fig_filename">[docs]</a><span class="k">def</span> <span class="nf">process_fig_filename</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">fig_format</span><span class="p">):</span>

    <span class="n">makedir</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fig_format</span> <span class="ow">in</span> <span class="n">image_name</span><span class="p">:</span>
        <span class="n">path2saved</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">]:</span>
        <span class="n">path2saved</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
        <span class="n">fig_format</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">path2saved</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fig_format</span>
    
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dirname</span><span class="p">:</span>
        <span class="n">dirname</span><span class="o">+=</span><span class="s1">&#39;.&#39;</span>

    <span class="n">path2saved_png</span> <span class="o">=</span> <span class="n">dirname</span><span class="o">+</span><span class="s1">&#39;/png/&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
    <span class="n">makedir</span><span class="p">(</span><span class="n">path2saved_png</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path2saved</span><span class="p">,</span> <span class="n">path2saved_png</span></div>

<div class="viewcode-block" id="fit_and_plot"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.fit_and_plot">[docs]</a><span class="k">def</span> <span class="nf">fit_and_plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">power</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pad</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlog</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">ylog</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scatter</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
    <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="n">fontsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">legend_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  
    <span class="n">linewidth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hor</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ver</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fig_format</span> <span class="o">=</span> <span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">ver_lines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xy_line</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x_nbins</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
    <span class="n">convex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dashes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">corner_letter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hide_ylabels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hide_xlabels</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">annotate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot multiple plots on one axes using *data*</span>
<span class="sd">    </span>
<span class="sd">    return filename of saved plot</span>

<span class="sd">    ax (axes) - matplotlib axes object - to create multiple axes plots</span>

<span class="sd">    data - each entry should be </span>
<span class="sd">        (X, Y, fmt) </span>
<span class="sd">        or </span>
<span class="sd">        (X, Y, fmt, label) </span>
<span class="sd">        or</span>
<span class="sd">        {&#39;x&#39;:,&#39;y&#39;:, &#39;fmt&#39;:, &#39;label&#39;, &#39;xticks&#39; }    not implemented for powers and scatter yet</span>
<span class="sd">        or</span>
<span class="sd">        (X, Y, R, fmt) - for scatter = 1, R - size of spots</span>

<span class="sd">    first, last - allows to call this function multiple times to put several plots on one axes. Use first = 1, last = 0 for the first plot, 0, 0 for intermidiate, and 0, 1 for last</span>

<span class="sd">    power (int) - the power of polynom, turn on fitting</span>

<span class="sd">    scatter (bool) - plot scatter points - the data format is slightly different - see *data*</span>

<span class="sd">    convex (bool) - plot convex hull around points like in ATAT</span>

<span class="sd">    fill (bool) - fill under the curves</span>

<span class="sd">    filename (str) - name of file with figure, image_name - deprecated</span>
<span class="sd">    fig_format (str) - format of saved file.</span>
<span class="sd">    dpi    - resolution of saved file</span>


<span class="sd">    ver_lines - list of dic args for  vertical lines {&#39;x&#39;:, &#39;c&#39;, &#39;lw&#39;:, &#39;ls&#39;:}</span>
<span class="sd">    ver - vertical line at 0</span>
<span class="sd">    hor - horizontal line at 0</span>


<span class="sd">    hide_ylabels - just hide numbers</span>

<span class="sd">    ncol - number of legend columns</span>

<span class="sd">    corner_letter - letter in the corner of the plot</span>

<span class="sd">    pad - additional padding, if dict than the same keys as in plt.subplots_adjust() are used</span>

<span class="sd">    annotate - annotate each point, &#39;annotates&#39; list should be in data dic!</span>

<span class="sd">    linewidth - was 3 !</span>
<span class="sd">    markersize - was 10</span>

<span class="sd">    x_nbins - number of ticks</span>

<span class="sd">    TODO:</span>
<span class="sd">    remove some arguments that can be provided in data dict</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">image_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">image_name</span>  <span class="o">=</span> <span class="n">filename</span>


    <span class="k">if</span> <span class="n">fontsize</span><span class="p">:</span>
        <span class="n">header</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">fontsize</span><span class="o">+</span><span class="mi">4</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">legend_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">legend_fontsize</span> <span class="o">=</span> <span class="n">fontsize</span>
    <span class="k">if</span> <span class="n">legend_fontsize</span><span class="p">:</span>
        <span class="n">header</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span> <span class="n">legend_fontsize</span><span class="p">)</span> 



    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">first</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">):</span>
        <span class="n">last</span>  <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">last</span>
    <span class="c1"># print(&#39;fit_and_plot, first and last&#39;, first, last)</span>



    <span class="c1"># print(&#39;ax is&#39;, ax)</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
            <span class="c1"># fig, ax = plt.subplots(1,1,figsize=figsize)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span> <span class="c1"># get current axes )))</span>
        <span class="c1"># ax  = fig.axes</span>
    <span class="c1"># print(&#39;ax is&#39;, ax)</span>

    <span class="k">if</span> <span class="n">title</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
    <span class="c1"># print(dir(plt))</span>
    <span class="c1"># print(ax)</span>

    <span class="c1"># plt.ylabel(ylabel, axes = ax)</span>
    <span class="c1"># print(ylabel)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    

    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s1">&#39;&#39;</span>
        <span class="c1"># plt.xlabel(xlabel, axes = ax)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>




    <span class="k">if</span> <span class="n">corner_letter</span><span class="p">:</span>
        <span class="c1"># print(corner_letter)</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">corner_letter</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">sz</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span> <span class="c1"># transform = None - by default in data coordinates!</span>

        <span class="c1"># text(x, y, s, bbox=dict(facecolor=&#39;red&#39;, alpha=0.5))</span>


    <span class="k">if</span> <span class="n">convex</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">ConvexHull</span>



    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">scatter</span><span class="p">:</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>  <span class="n">s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>

            <span class="n">con</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c1"># print(con)</span>
            <span class="c1"># sys.exit()</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">key</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


                <span class="n">xyf</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fmt</span><span class="p">]</span>
                <span class="n">con</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">label</span><span class="p">}</span> <span class="c1">#fmt -color style</span>

            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;fmt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                    <span class="n">con</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># print(con)</span>

                <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
                    <span class="n">con</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>

                <span class="k">if</span> <span class="s1">&#39;xticks&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="p">:</span>
                    <span class="c1"># print(con[&#39;xticks&#39;])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;xticks&#39;</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;xticks&#39;</span><span class="p">]</span>

                <span class="n">xyf</span> <span class="o">=</span> <span class="p">[</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">]]</span>

                <span class="c1"># if &#39;lw&#39; in </span>
            <span class="k">if</span> <span class="n">linewidth</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>

            <span class="c1"># print(con)</span>
            <span class="c1"># sys.exit()</span>
                
            <span class="k">if</span> <span class="n">markersize</span><span class="p">:</span>
                <span class="n">con</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">markersize</span>

            <span class="c1"># print(&#39;key is &#39;, key)</span>
            <span class="c1"># print(&#39;x &#39;, xyf[0])</span>






            <span class="n">con_other_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;annotates&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">con_other_args</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">con_other_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">xyf</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">con_other_args</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">power</span><span class="p">:</span>
                <span class="n">coeffs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">power</span><span class="p">)</span>        
                
                <span class="n">fit_func1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">coeffs1</span><span class="p">)</span>
                <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">fit_y1</span> <span class="o">=</span> <span class="n">fit_func1</span><span class="p">(</span><span class="n">x_range</span><span class="p">);</span> 
         

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">fit_y1</span><span class="p">,</span> <span class="n">xyf</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">)</span>

                <span class="c1"># x_min  = fit_func2.deriv().r[power-2] #derivative of function and the second cooffecient is minimum value of x.</span>
                <span class="c1"># y_min  = fit_func2(x_min)</span>
                <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyf</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;R^2 = </span><span class="si">{:5.2f}</span><span class="s1"> for </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_value</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>







            <span class="k">if</span> <span class="n">annotate</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">adjustText_installed</span><span class="p">:</span>

                    <span class="n">ts</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;annotates&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]):</span>
                        <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;fmt&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">adjust_text</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                        <span class="c1"># force_points=10, force_text=10, force_objects = 0.5, </span>
                        <span class="n">expand_text</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                        <span class="n">expand_points</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                        <span class="c1"># lim = 150,</span>
                        <span class="n">expand_align</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                        <span class="c1"># expand_objects=(0, 0),</span>
                        <span class="n">text_from_text</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">text_from_points</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="c1"># arrowprops=dict(arrowstyle=&#39;-&gt;&#39;, color=&#39;black&#39;)</span>
                        <span class="p">)</span>


                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">con</span><span class="p">[</span><span class="s1">&#39;annotates&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
                        <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                        <span class="c1"># bbox=dict(boxstyle=&#39;round,pad=0.2&#39;, fc=&#39;yellow&#39;, alpha=0.3),</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s1">&#39;arc3,rad=0.5&#39;</span><span class="p">,</span> 
                                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>            





            <span class="c1"># print(key)</span>
            <span class="c1"># print(con)</span>
            <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
                <span class="s1">&#39;&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="n">con</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">convex</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xyf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyf</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">simplex</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">simplices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>



    <span class="k">if</span> <span class="n">hor</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#horizontal line</span>

    <span class="k">if</span> <span class="n">ver</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1"># vertical line at 0 always </span>

    <span class="k">if</span> <span class="n">ver_lines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ver_lines</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xy_line</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="c1"># print(ylim)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
        <span class="c1"># print(x)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_nbins</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">x_nbins</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">xlim</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> 
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">xlog</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span> 
        <span class="k">if</span> <span class="s2">&quot;sym&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ylog</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linthreshx</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hide_ylabels</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>
        <span class="c1"># ax.yaxis.set_ticklabels([])</span>
    <span class="k">if</span> <span class="n">hide_xlabels</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullFormatter</span><span class="p">())</span>


    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> 
        <span class="n">scatterpoints</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># for legend</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="n">legend</span><span class="p">,</span> <span class="n">scatterpoints</span> <span class="o">=</span> <span class="n">scatterpoints</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">ncol</span><span class="p">)</span>
        <span class="c1"># plt.legend()</span>

    <span class="c1"># plt.tight_layout(pad = 2, h_pad = 0.5)</span>



    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
        <span class="c1"># pad =0.13</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wspace</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


    <span class="n">path2saved</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">last</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
            <span class="c1"># plt.subplots_adjust(hspace=0.1)</span>

            <span class="n">path2saved</span><span class="p">,</span> <span class="n">path2saved_png</span> <span class="o">=</span> <span class="n">process_fig_filename</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">fig_format</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path2saved</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_format</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path2saved_png</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
            
            <span class="n">print_and_log</span><span class="p">(</span><span class="s2">&quot;Image saved to &quot;</span><span class="p">,</span> <span class="n">path2saved</span><span class="p">,</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># print_and_log(show)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">printlog</span><span class="p">(</span><span class="s1">&#39;Attention! last = False, no figure is saved&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path2saved</span></div>


<div class="viewcode-block" id="plot_bar"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.plot_bar">[docs]</a><span class="k">def</span> <span class="nf">plot_bar</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">,</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.18</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">barwidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="p">[],</span><span class="n">data2</span> <span class="o">=</span> <span class="p">[],</span><span class="n">data3</span> <span class="o">=</span> <span class="p">[],</span><span class="n">data4</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="o">**</span><span class="n">data</span><span class="p">):</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">barwidth</span>      <span class="c1"># the width of the bars</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">:</span> 
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xlabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># print N</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># the x locations for the groups</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="c1"># print &#39;color&#39;, data[key][2]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="c1"># yerr=menStd)</span>
            <span class="c1"># print ind</span>
            <span class="n">shift</span><span class="o">+=</span><span class="n">width</span>

    <span class="k">elif</span> <span class="n">data1</span> <span class="ow">and</span> <span class="n">data4</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>   <span class="c1">#5:7 ratio for A4, </span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="n">width_ratios</span> <span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                               <span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1"># fig, ax = plt.subplots()</span>
        <span class="c1"># fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, sharex=&#39;col&#39;)#, sharey=&#39;row&#39;) equal</span>

        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">data1</span><span class="p">),</span> <span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="n">data2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span><span class="n">data3</span><span class="p">),</span> <span class="p">(</span><span class="n">ax4</span><span class="p">,</span> <span class="n">data4</span><span class="p">):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xlabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># the x locations for the groups</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="c1"># yerr=menStd)</span>
                <span class="c1"># print ind</span>
                <span class="n">shift</span><span class="o">+=</span><span class="n">width</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="c1"># ax.set_xticklabels(xlabels , rotation=70 )</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="p">)</span>
    
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">80</span> <span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data4</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">80</span> <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
        <span class="c1"># plt.ylabel(ylabel)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
        <span class="c1"># ax1.axis(&#39;tight&#39;)</span>
        <span class="c1"># ax2.axis(&#39;tight&#39;)</span>
        <span class="c1"># ax3.axis(&#39;tight&#39;)</span>
        <span class="c1"># ax4.axis(&#39;tight&#39;)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>





    <span class="k">elif</span> <span class="n">data1</span> <span class="ow">and</span> <span class="n">data2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data4</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>   <span class="c1">#5:7 ratio for A4, </span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="n">width_ratios</span> <span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                               <span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">data1</span><span class="p">),</span> <span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="n">data2</span><span class="p">):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xlabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># the x locations for the groups</span>
            <span class="c1"># print ind+width</span>
            <span class="c1"># print data[0][0]</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.2</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="c1"># yerr=menStd)</span>
                <span class="c1"># print ind</span>
                <span class="n">shift</span><span class="o">+=</span><span class="n">width</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="c1"># ax.set_xticklabels(xlabels , rotation=70 )</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n1</span>  <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span> <span class="n">data1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">]</span> <span class="c1"># </span>
        <span class="n">names2</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n1</span>  <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span> <span class="n">data2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">]</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">names1</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">80</span> <span class="p">)</span> <span class="c1"># Names of configurations on x axis</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">names2</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">80</span> <span class="p">)</span> 

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">data1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data2</span><span class="p">:</span>
        <span class="c1"># fig = plt.figure(figsize=(10,5))   #5:7 ratio for A4, </span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span> <span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>                               
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># ax2 = plt.subplot(gs[1])</span>

        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">data1</span><span class="p">),:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xlabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># the x locations for the groups</span>
            <span class="c1"># print ind+width</span>
            <span class="c1"># print data[0][0]</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.2</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="c1"># yerr=menStd)</span>
                <span class="c1"># print ind</span>
                <span class="n">shift</span><span class="o">+=</span><span class="n">width</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="c1"># ax.set_xticklabels(xlabels , rotation=70 )</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n1</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">n2</span> <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span> <span class="n">data1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="p">]</span> <span class="c1"># </span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span> <span class="n">names1</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">80</span> <span class="p">)</span> <span class="c1"># Names of configurations on x axis</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.axis(&#39;tight&#39;)</span>

    <span class="c1"># ax.set_yscale(&#39;log&#39;)</span>
    <span class="c1"># plt.yscale(&#39;symlog&#39;, linthreshx=0.1)</span>

    <span class="c1"># ax.set_title(&#39;Scores by group and gender&#39;)</span>


    <span class="k">def</span> <span class="nf">autolabel</span><span class="p">(</span><span class="n">rects</span><span class="p">):</span>
        <span class="c1"># attach some text labels</span>
        <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">rects</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.05</span><span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

    <span class="c1"># autolabel(rects1)</span>
    <span class="c1"># autolabel(rects2)</span>


    <span class="c1"># plt.axis(&#39;tight&#39;)</span>
    <span class="c1"># plt.margins(0.05, 0)</span>

    <span class="c1"># plt.tight_layout()</span>
    <span class="c1"># elif data1: gs.tight_layout(fig)</span>

    <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
        <span class="n">print_and_log</span><span class="p">(</span> <span class="s2">&quot;Saving image ...&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">),</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span></div>





<div class="viewcode-block" id="plot_and_annotate"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.plot_and_annotate">[docs]</a><span class="k">def</span> <span class="nf">plot_and_annotate</span><span class="p">(</span><span class="n">power</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">,</span> <span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="o">**</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Should be used in two below sections!</span>
<span class="sd">    Creates one plot with two dependecies and fit them;</span>
<span class="sd">    return minimum fitted value of x2 and corresponding valume of y2; </span>
<span class="sd">    if name == &quot;&quot; image will not be plotted</span>
<span class="sd">    power - the power of polynom</span>

<span class="sd">    data - each entry should be (X, Y, &#39;r-&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># print data</span>
    <span class="c1"># coeffs1 = np.polyfit(x1, y1, power)        </span>
    <span class="c1"># coeffs2 = np.polyfit(x2, y2, power)</span>
    
    <span class="c1"># fit_func1 = np.poly1d(coeffs1)</span>
    <span class="c1"># fit_func2 = np.poly1d(coeffs2)</span>
    
    <span class="c1">#x_min  = fit_func2.deriv().r[power-2] #derivative of function and the second cooffecient is minimum value of x.</span>
    <span class="c1">#y_min  = fit_func2(x_min)</span>
    
    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># x_range = np.linspace(min(x2), max(x2))</span>
        <span class="c1"># fit_y1 = fit_func1(x_range); </span>
        <span class="c1"># fit_y2 = fit_func2(x_range); </span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        




        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span> 
                <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;T1m&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="n">xytext</span><span class="p">,</span> 
                <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.2&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">),</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s1">&#39;arc3,rad=0.5&#39;</span><span class="p">,</span> 
                                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">))</span>










        <span class="k">if</span> <span class="n">fit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                <span class="n">f1</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span> 
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlim</span><span class="p">:</span> 
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="c1"># axes = plt.gca()</span>
            <span class="c1"># axes.set_xlim([xmin,xmax])</span>
            <span class="c1"># axes.set_ylim([ymin,ymax])</span>
        <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


        <span class="c1"># plt.plot(x2, y2, &#39;bo&#39;, label = &#39;r&#39;   )</span>
        <span class="c1"># plt.plot(x_range, fit_y1, &#39;r-&#39;, label = &#39;init_fit&#39;)</span>
        <span class="c1"># plt.plot(x_range, fit_y2, &#39;b-&#39;, label = &#39;r_fit&#39;   )</span>



        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
            <span class="c1"># print &quot;Saving image ...&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="k">return</span> </div>


<div class="viewcode-block" id="plot_bar_simple"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.plot_bar_simple">[docs]</a><span class="k">def</span> <span class="nf">plot_bar_simple</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;xlabel&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">,</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]):</span>

    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.6</span>       <span class="c1"># the width of the bars</span>



    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>   <span class="c1">#5:7 ratio for A4, </span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>


    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xlabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># print xlabels</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># the x locations for the groups</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># for d in data:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
    <span class="c1"># print d[2]</span>

    <span class="n">rects</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span> <span class="p">)</span><span class="c1"># yerr=menStd)</span>
    <span class="n">rects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">rects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="c1"># rects[1].set_color(&#39;b&#39;)</span>

    <span class="c1"># print ind</span>
    <span class="n">shift</span><span class="o">+=</span><span class="n">width</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="c1">#+width)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabels</span> <span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">50</span> <span class="p">)</span>
        
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
    <span class="n">red_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Substitutional&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">+</span><span class="p">[</span><span class="n">red_patch</span><span class="p">],</span> <span class="n">labels</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;Substitutional&#39;</span><span class="p">],</span> <span class="n">loc</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># ax.legend(handles=[red_patch], loc = 8)</span>
    

    <span class="c1"># ax.legend(loc=2, )</span>

    <span class="c1"># ax.set_yscale(&#39;log&#39;)</span>
    <span class="c1"># plt.yscale(&#39;symlog&#39;, linthreshx=0.1)</span>

    <span class="c1"># ax.set_title(&#39;Scores by group and gender&#39;)</span>
    <span class="k">if</span> <span class="n">xlim</span><span class="p">:</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="c1"># axes = plt.gca()</span>
        <span class="c1"># axes.set_xlim([xmin,xmax])</span>
        <span class="c1"># axes.set_ylim([ymin,ymax])</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">autolabel</span><span class="p">(</span><span class="n">rects</span><span class="p">):</span>
        <span class="c1"># attach some text labels</span>
        <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">rects</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.05</span><span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">autolabel</span><span class="p">(</span><span class="n">rects</span><span class="p">)</span>
    <span class="c1"># autolabel(rects2)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
        <span class="c1"># print &quot;Saving image ...&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span></div>








<div class="viewcode-block" id="plot_conv"><a class="viewcode-back" href="../../siman.html#siman.picture_functions.plot_conv">[docs]</a><span class="k">def</span> <span class="nf">plot_conv</span><span class="p">(</span><span class="n">list_of_calculations</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">calc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
    <span class="n">type_of_plot</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conv_ext</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">labelnames</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Allows to fit and plot different properties;</span>
<span class="sd">    Input:</span>
<span class="sd">    &#39;type_of_plot&#39; - (&quot;fit_gb_volume&quot;-fits gb energies and volume and plot dependencies without relaxation and after it,</span>
<span class="sd">     &#39;dimer&#39;</span>

<span class="sd">    cl - calculation to use - new interface, please rewrite the old one</span>

<span class="sd">    &quot;&quot;&quot;</span>

            
    <span class="k">def</span> <span class="nf">fit_and_plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">image_name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Should be used in two below sections!</span>
<span class="sd">        Creates one plot with two dependecies and fit them;</span>
<span class="sd">        return minimum fitted value of x2 and corresponding valume of y2; </span>
<span class="sd">        if name == &quot;&quot; image will not be plotted</span>
<span class="sd">        power - the power of polynom</span>

<span class="sd">        lines - add lines at x = 0 and y = 0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coeffs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>        
        <span class="n">coeffs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>
        
        <span class="n">fit_func1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">coeffs1</span><span class="p">)</span>
        <span class="n">fit_func2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">coeffs2</span><span class="p">)</span>
        
        <span class="c1">#x_min  = fit_func2.deriv().r[power-2] #derivative of function and the second cooffecient is minimum value of x.</span>
        <span class="c1">#y_min  = fit_func2(x_min)</span>
        
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>

            <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
            <span class="n">fit_y1</span> <span class="o">=</span> <span class="n">fit_func1</span><span class="p">(</span><span class="n">x_range</span><span class="p">);</span> 
            <span class="n">fit_y2</span> <span class="o">=</span> <span class="n">fit_func2</span><span class="p">(</span><span class="n">x_range</span><span class="p">);</span> 
            
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">6.1</span><span class="p">))</span>
            <span class="c1"># plt.title(name)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">)))</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;relaxed&#39;</span>   <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">fit_y1</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,)</span> <span class="c1">#label = &#39;init_fit&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">fit_y2</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,)</span> <span class="c1">#label = &#39;r_fit&#39;   )</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>



            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="c1">#plt.savefig(&#39;images/&#39;+image_name)</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">path_to_images</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span>
            <span class="n">makedir</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">print_and_log</span><span class="p">(</span> <span class="s1">&#39;Saving file ...&#39;</span><span class="p">,</span><span class="n">file</span><span class="p">,</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fit_func2</span>  



    <span class="k">if</span> <span class="n">list_of_calculations</span><span class="p">:</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">list_of_calculations</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">name</span> <span class="o">=</span> <span class="p">[];</span> 
       
        <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        
        <span class="n">image_name</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">energies</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">init_energies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gb_volumes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pressures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pressures_init</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sigma_xx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sigma_yy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sigma_zz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">e_gbs</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">e_gbs_init</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;e_imp&quot;</span><span class="p">:</span>
        <span class="n">e_imps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">v_imps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>        
            <span class="n">e_imps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">e_imp</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">v_imps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">v_imp</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">vlength</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%.1f</span><span class="se">\n</span><span class="si">%.1f</span><span class="se">\n</span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>
        <span class="c1">#l = lengths[0]</span>
        <span class="c1">#print str(l[0])+&#39;\n&#39;+str(l[1])+&#39;\n&#39;+str(l[2])</span>


        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Sizes, $\AA$&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Impurity energy, meV&quot;</span>
        <span class="n">ylabel2</span> <span class="o">=</span> <span class="s2">&quot;Impurity volume, $\AA^3$&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; other cells&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_imps</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">e_imps</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;energy&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v_imps</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;volume&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">wspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1">#plt.ticker.formatter.set_scientific(True)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/e_imp_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span><span class="c1">#+str(image_name))#+&#39;e_imp&#39;)</span>


    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;e_2imp&quot;</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">dist_between_imp</span><span class="p">(</span><span class="n">cl</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Only for two impurities&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">xcart</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cl</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">xcart</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#assuming that impurities are at the end of xcart list.</span>

        <span class="n">e_imps</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># binding energy</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#dist between impurities</span>
        
        <span class="n">e_imps_ex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dist_ex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name_ex</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>        
            <span class="n">cl</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
            <span class="n">e_imps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">e_imp</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
            <span class="c1">#dist.append( &quot;%s\n%.1f&quot;%(id[0],dist_between_imp(cl) ) )</span>
            <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dist_between_imp</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>  <span class="p">)</span>







        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Distance between atoms, $\AA$&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Interaction energy, meV&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        
        <span class="c1"># plt.title(str(name)+&#39; v1-15&#39;)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="c1">#x = range( len(e_imps) )</span>
        <span class="c1">#plt.xticks(x, dist)</span>
        <span class="c1"># plt.yscale(&#39;log&#39;)</span>
        <span class="c1"># plt.yscale(&#39;semilog&#39;)</span>
        <span class="k">if</span> <span class="n">labelnames</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labelnames</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">label</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">name_ex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">e_imps</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
        

        <span class="k">if</span> <span class="n">conv_ext</span><span class="p">:</span> <span class="c1">#manually add </span>
            <span class="k">for</span> <span class="n">conv</span> <span class="ow">in</span> <span class="n">conv_ext</span><span class="p">:</span>
                <span class="n">e_imps_ex</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">dist_ex</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>        
                    <span class="n">cl</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
                    <span class="n">e_imps_ex</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">e_imp</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
                    <span class="c1">#dist.append( &quot;%s\n%.1f&quot;%(id[0],dist_between_imp(cl) ) )</span>
                    <span class="n">dist_ex</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dist_between_imp</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>  <span class="p">)</span>
                <span class="n">name_ex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist_ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e_imps_ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;go-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist_ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">e_imps_ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>






        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#horizontal line</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># plt.subplots_adjust(left=None, bottom=0.2, right=None, top=None,</span>
        <span class="c1">#         wspace=None, hspace=None)</span>
        <span class="c1"># #plt.ticker.formatter.set_scientific(True)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_to_images</span><span class="o">+</span><span class="s1">&#39;e_2imp_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span><span class="c1">#+str(image_name))#+&#39;e_imp&#39;)</span>


    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;fit_gb_volume_pressure&quot;</span><span class="p">:</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>
            <span class="c1">#energies.append(calc[id].energy_sigma0)</span>
            <span class="c1">#init_energies.append( calc[id].list_e_sigma0[0] ) </span>
            <span class="n">gb_volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">v_gb</span><span class="p">)</span>
            <span class="c1">#volumes.append(calc[id].end.vol)</span>
            <span class="n">pressures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">extpress</span><span class="o">/</span><span class="mf">1000.</span> <span class="p">)</span>
            <span class="n">pressures_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">extpress_init</span><span class="o">/</span><span class="mf">1000.</span> <span class="p">)</span>
            <span class="n">sigma_xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">stress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span>
            <span class="n">sigma_yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="p">)</span>
            <span class="n">sigma_zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">stress</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="p">)</span>
            <span class="c1">#pressures_init = pressures</span>
            <span class="n">e_gbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">e_gb</span><span class="p">)</span>
            <span class="n">e_gbs_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">e_gb_init</span> <span class="p">)</span>           
            <span class="c1"># print calc[id].bulk_extpress</span>

        <span class="n">power</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">fit_ve</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">gb_volumes</span><span class="p">,</span> <span class="n">e_gbs_init</span><span class="p">,</span>  <span class="n">gb_volumes</span><span class="p">,</span> <span class="n">e_gbs</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Grain boundary expansion (m$\AA$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Grain boundary energy (mJ/m$^2$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_fit_ve&quot;</span><span class="p">)</span>


        <span class="n">fit</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">pressures_init</span><span class="p">,</span> <span class="n">e_gbs_init</span><span class="p">,</span>  <span class="n">pressures</span><span class="p">,</span> <span class="n">e_gbs</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;External pressure (GPa)&quot;</span><span class="p">,</span> <span class="s2">&quot;Grain boundary  energy (mJ/m$^2$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_pe&quot;</span><span class="p">)</span>
        <span class="c1">#print fit</span>
        <span class="n">ext_p_min</span>  <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">power</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#external pressure in the minimum; derivative of function and the value of x in minimum</span>

        <span class="n">fit_sxe</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">sigma_xx</span><span class="p">,</span> <span class="n">e_gbs_init</span><span class="p">,</span>  <span class="n">sigma_xx</span><span class="p">,</span> <span class="n">e_gbs</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Sigma xx (MPa)&quot;</span><span class="p">,</span> <span class="s2">&quot;Grain boundary energy (mJ/m$^2$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_sxe&quot;</span><span class="p">)</span>
        <span class="n">sxe_min</span> <span class="o">=</span> <span class="n">fit_sxe</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">power</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#sigma xx at the minimum of energy</span>
        <span class="n">print_and_log</span><span class="p">(</span> <span class="s2">&quot;sigma xx at the minimum of energy is&quot;</span><span class="p">,</span> <span class="n">sxe_min</span><span class="p">,</span><span class="s2">&quot; MPa&quot;</span><span class="p">)</span>


        <span class="n">fit1</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">pressures_init</span><span class="p">,</span> <span class="n">gb_volumes</span><span class="p">,</span>  <span class="n">pressures</span><span class="p">,</span> <span class="n">gb_volumes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;External pressure (GPa)&quot;</span><span class="p">,</span> <span class="s2">&quot;Grain boundary expansion (m$\AA$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_pv&quot;</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span>
        <span class="c1">#print fit1</span>
        <span class="n">pulay</span> <span class="o">=</span> <span class="o">-</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">bulk_extpress</span>
        <span class="c1">#print &quot; At external pressure of %.0f MPa; Pulay correction is %.0f MPa.&quot; % (ext_p_min+pulay, pulay)       </span>
        <span class="c1">#print &quot; Egb = %.1f mJ m-2; Vgb = %.0f mA;&quot;%(fit(ext_p_min), fit1(ext_p_min)  )</span>
        <span class="n">print_and_log</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.fit.pe_pv &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; %0.f &amp; %0.f </span><span class="se">\\\\</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fit</span><span class="p">(</span><span class="n">ext_p_min</span><span class="p">),</span> <span class="n">fit1</span><span class="p">(</span><span class="n">ext_p_min</span><span class="p">),</span><span class="n">ext_p_min</span><span class="p">,</span> <span class="n">ext_p_min</span><span class="o">+</span><span class="n">pulay</span>   <span class="p">))</span>


        <span class="c1">#print &quot;\n At zero pressure with Pullay correction:&quot;</span>
        <span class="c1">#print &quot; Egb = %.1f mJ m-2; Vgb = %.0f mA; &quot; % (fit(-pulay), fit1(-pulay))</span>
        <span class="n">outstring</span> <span class="o">=</span>  <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.fit.pe_pv &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; %0.f &amp; %0.f</span><span class="se">\\\\</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fit</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span> <span class="n">fit1</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span><span class="o">-</span><span class="n">pulay</span><span class="p">,</span><span class="mi">0</span>    <span class="p">))</span>
        <span class="c1"># print outstring</span>
        <span class="n">calc</span><span class="p">[</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">egb</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">)</span>
        <span class="n">calc</span><span class="p">[</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">vgb</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outstring</span> <span class="c1">#fit(ext_p_min), fit1(ext_p_min) </span>


    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;fit_gb_volume&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        should be rewritten using fit_and_plot() function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>
            <span class="c1">#energies.append(calc[id].energy_sigma0)</span>
            <span class="c1">#init_energies.append( calc[id].list_e_sigma0[0] ) </span>
            <span class="n">gb_volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">v_gb</span><span class="p">)</span>
            <span class="n">e_gbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">e_gb</span><span class="p">)</span>
            <span class="n">e_gbs_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">e_gb_init</span> <span class="p">)</span>           


        <span class="n">power</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">fit_ve</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">gb_volumes</span><span class="p">,</span> <span class="n">e_gbs_init</span><span class="p">,</span>  <span class="n">gb_volumes</span><span class="p">,</span> <span class="n">e_gbs</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Excess volume ($m\AA$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Twin energy ($mJ/m^2$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_fit_ve&quot;</span><span class="p">)</span>

        <span class="n">vgb_min</span>  <span class="o">=</span> <span class="n">fit_ve</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">power</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>


        <span class="c1">#print &quot;Fit of excess volume against energy. Pressure is uknown:&quot;</span>
        <span class="c1">#print &quot;Test Egb_min = %.1f mJ m-2; v_min = %.0f mA;&quot;%(fit_ve(vgb_min), vgb_min)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.fit.ve &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; </span><span class="si">%.0f</span><span class="s2"> &amp; - &amp; - </span><span class="se">\\\\</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fit_ve</span><span class="p">(</span><span class="n">vgb_min</span><span class="p">),</span> <span class="n">vgb_min</span><span class="p">,</span>   <span class="p">))</span>

    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;fit_gb_volume2&quot;</span><span class="p">:</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>
            <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">energy_sigma0</span><span class="p">)</span>
            <span class="n">init_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">list_e_sigma0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> 
            <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
            <span class="n">pressures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">extpress</span> <span class="p">)</span>
            <span class="n">pressures_init</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">extpress_init</span> <span class="p">)</span>

        <span class="n">power</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">pulay</span> <span class="o">=</span> <span class="mi">500</span>

        <span class="n">fit_ve</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="n">init_energies</span><span class="p">,</span>  <span class="n">volumes</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Volume ($\AA^3$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy  sigma-&gt;0 ($eV$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_fit_ve&quot;</span><span class="p">)</span>
        
        <span class="n">Vmin</span>  <span class="o">=</span> <span class="n">fit_ve</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">power</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># minimum volume at the minimum energy</span>
        <span class="n">Emin</span>  <span class="o">=</span> <span class="n">fit_ve</span><span class="p">(</span><span class="n">Vmin</span><span class="p">)</span>

        <span class="n">fit_pe</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">pressures_init</span><span class="p">,</span> <span class="n">init_energies</span><span class="p">,</span>  <span class="n">pressures</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> 
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;External pressure ($MPa$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy  sigma-&gt;0 ($eV$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_fit_pe&quot;</span><span class="p">)</span>

        <span class="n">ext_p_min</span>  <span class="o">=</span> <span class="n">fit_pe</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">power</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#external pressure in the minimum; derivative of function and the value of x in minimum</span>
        

        <span class="n">fit_pv</span> <span class="o">=</span> <span class="n">fit_and_plot</span><span class="p">(</span><span class="n">pressures_init</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span>  <span class="n">pressures</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;External pressure ($MPa$)&quot;</span><span class="p">,</span> <span class="s2">&quot;Volume of cell ($\AA^3$)&quot;</span><span class="p">,</span> 
            <span class="n">image_name</span><span class="o">+</span><span class="s2">&quot;_fit_pv&quot;</span><span class="p">)</span>


             
        <span class="n">atP</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; Emin = </span><span class="si">%.3f</span><span class="s2"> meV;  Vmin = </span><span class="si">%.0f</span><span class="s2"> A^3; &quot;</span><span class="o">%</span><span class="p">(</span> <span class="n">fit_pe</span><span class="p">(</span><span class="n">ext_p_min</span><span class="p">),</span> <span class="n">fit_pv</span><span class="p">(</span><span class="n">ext_p_min</span><span class="p">)</span>  <span class="p">)</span>  <span class="p">)</span> <span class="o">+</span> \
              <span class="p">(</span><span class="s2">&quot; for the minimum of energy relative to external pressure. The value of pressure is </span><span class="si">%.0f</span><span class="s2"> MPa; Pulay correction is </span><span class="si">%.0f</span><span class="s2"> MPa.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ext_p_min</span><span class="o">+</span><span class="n">pulay</span><span class="p">,</span> <span class="n">pulay</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="n">at_zeroP</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; Emin = </span><span class="si">%.3f</span><span class="s2"> meV;  Vmin = </span><span class="si">%.0f</span><span class="s2"> A^3; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fit_pe</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span> <span class="n">fit_pv</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">)</span> <span class="p">)</span>  <span class="p">)</span> <span class="o">+</span> \
                   <span class="p">(</span><span class="s2">&quot; the value of energy and volume at zero pressure with Pullay correction&quot;</span> <span class="p">)</span>
        
        <span class="c1">#print &quot; Emin = %.3f meV;  Vmin = %.0f A^3;  for the minimum of energy relative to volume at some external pressure&quot;%(fit_ve(Vmin), Vmin )</span>
        <span class="c1">#print atP</span>
        <span class="c1">#print at_zeroP</span>

        <span class="n">print_and_log</span><span class="p">(</span> <span class="s2">&quot;Compare V at -pulay and V for energy minimum&quot;</span><span class="p">,</span> <span class="n">fit_pv</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span> <span class="n">Vmin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fit_pe</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span> <span class="n">fit_pv</span><span class="p">(</span><span class="o">-</span><span class="n">pulay</span><span class="p">),</span> <span class="n">Emin</span><span class="p">,</span> <span class="n">Vmin</span>








    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;kpoint_conv&quot;</span><span class="p">:</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">list_of_calculations</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;4&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">potenergy</span><span class="p">)</span>
            <span class="n">kpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">kspacing</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

            <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span><span class="s1">&#39;bo-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total energy (eV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;KSPACING along 3rd recip. vector ($\AA ^{-1}$)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span><span class="n">times</span><span class="p">,</span><span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Elapsed time (min)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;kconv&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;contour&quot;</span><span class="p">:</span>
        <span class="n">alist</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span>        <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">calc</span><span class="p">[</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;a_c_convergence/&quot;</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="s2">&quot;.out&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;END DATASET(S)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span> <span class="c1">#Find lattice parameters and corresponding energies</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">a</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">c</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span> <span class="n">alist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> 
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clist</span><span class="p">:</span> <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;acell</span><span class="si">%i</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> Bohr</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="o">/</span><span class="n">to_ang</span><span class="p">,</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="o">/</span><span class="n">to_ang</span><span class="p">,</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="n">to_ang</span> <span class="p">)</span>   <span class="p">)</span>
            <span class="c1">#print &quot;etotal%i %f\n&quot;%(k, calc[id].energy_sigma0/to_eV ),</span>
            <span class="n">k</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">clist</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Zinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        
        <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clist</span><span class="p">)):</span>
                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">conv</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">alist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="n">clist</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">energy_sigma0</span>
                        <span class="n">Zinv</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">energy_sigma0</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;etotal</span><span class="si">%i</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">calc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">energy_sigma0</span><span class="o">/</span><span class="n">to_eV</span> <span class="p">)</span>   <span class="p">)</span>
                        <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;+Overall time at end (sec) : cpu=     976300.2  wall=     976512.8&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span>

        <span class="c1">#Make two plots for different a and c</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clist</span><span class="p">,</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;a=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alist</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total energy (eV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;c parameter ($\AA$)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clist</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">Zinv</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;c=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">clist</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total energy (eV)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;a parameter ($\AA$)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">conv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

        <span class="c1">#Make contour</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$a$ ($\AA$)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$c/a$&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/ru-contourf.png&#39;</span><span class="p">)</span>
        <span class="c1">#plt.show()</span>


        <span class="c1">#Make equation of state</span>
        <span class="n">eos</span> <span class="o">=</span> <span class="n">EquationOfState</span><span class="p">(</span><span class="n">clist</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="c1">#print &quot;a = &quot;, alist[2]</span>
        <span class="n">print_and_log</span><span class="p">(</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        v0 = </span><span class="si">{0}</span><span class="s1"> A^3</span>
<span class="s1">        E0 = </span><span class="si">{1}</span><span class="s1"> eV</span>
<span class="s1">        B  = </span><span class="si">{2}</span><span class="s1"> eV/A^3&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">eos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;images/a[2]-eos.png&#39;</span><span class="p">)</span> 

        <span class="n">eos</span> <span class="o">=</span> <span class="n">EquationOfState</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span><span class="n">Zinv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="c1">#print &quot;c = &quot;, clist[2]</span>
        <span class="n">print_and_log</span><span class="p">(</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        v0 = </span><span class="si">{0}</span><span class="s1"> A^3</span>
<span class="s1">        E0 = </span><span class="si">{1}</span><span class="s1"> eV</span>
<span class="s1">        B  = </span><span class="si">{2}</span><span class="s1"> eV/A^3&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">eos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;images/c[2]-eos.png&#39;</span><span class="p">)</span> 


    <span class="k">if</span> <span class="n">type_of_plot</span> <span class="o">==</span> <span class="s2">&quot;dimer&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cl</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span>  <span class="n">calc</span><span class="p">[</span><span class="n">list_of_calculations</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of distances</span>


        
        <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">natom</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span>


        <span class="c1"># print (cl.end.list_xcart)</span>
        <span class="k">for</span> <span class="n">xcart</span> <span class="ow">in</span> <span class="n">cl</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">list_xcart</span><span class="p">:</span>
            <span class="c1"># x = xcart[1]</span>
            <span class="c1"># d = (x[0]**2 + x[1]**2 + x[2]**2)**0.5</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xcart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xcart</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#assuming there are only two atoms</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">xcart</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xcart</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">)</span>

            <span class="n">x1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="n">y1</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">list_e_without_entr</span>
        <span class="n">power</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dimer&#39;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Bond length&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Full energy&#39;</span>
        <span class="c1"># print(x1, y1)</span>
        <span class="n">coeffs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>        
      
        <span class="n">fit_func1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">coeffs1</span><span class="p">)</span>

        <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
        <span class="n">fit_y1</span> <span class="o">=</span> <span class="n">fit_func1</span><span class="p">(</span><span class="n">x_range</span><span class="p">);</span> 
        <span class="n">f</span> <span class="o">=</span> <span class="n">fit_func1</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>
        <span class="n">min_e</span> <span class="o">=</span> <span class="n">fit_func1</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>
        <span class="n">printlog</span><span class="p">(</span><span class="s2">&quot;The minimum energy per atom and optimal length of dimer are </span><span class="si">{:.3f}</span><span class="s2"> eV and </span><span class="si">{:.3f}</span><span class="s2"> A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">min_e</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">printlog</span><span class="p">(</span><span class="s2">&quot;The atomization energy for dimer is </span><span class="si">{:.3f}</span><span class="s2"> eV ; The energy of atom in box is taken from the provided b_id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_e</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cl</span><span class="o">.</span><span class="n">e_ref</span><span class="p">),</span> <span class="n">imp</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reference energy was not found&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;init&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">fit_y1</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;init_fit&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">path2saved</span><span class="p">,</span> <span class="n">path2saved_png</span> <span class="o">=</span> <span class="n">process_fig_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fig_format</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span></div>











</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Siman 0.9.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Dmitry Aksenov.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>